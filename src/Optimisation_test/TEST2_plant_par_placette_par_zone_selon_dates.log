TEST #2: Combien de plants par placette / par zone / dans une plage de dates ?
Pour les dates '2017-05-01' et '2017-09-01'  -> En gros, ce sont tout mes plants, tous mes dates sont entre cette plage de date.

1.a) Par PLACETTE

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|QUERY PLAN                                                                                                                                                                     |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|Sort  (cost=319.35..320.00 rows=260 width=11) (actual time=20.860..20.869 rows=255.00 loops=1)                                                                                 |
|  Sort Key: pl.plac                                                                                                                                                            |
|  Sort Method: quicksort  Memory: 32kB                                                                                                                                         |
|  Buffers: shared hit=44                                                                                                                                                       |
|  ->  HashAggregate  (cost=306.32..308.92 rows=260 width=11) (actual time=20.471..20.504 rows=255.00 loops=1)                                                                  |
|        Group Key: pl.plac                                                                                                                                                     |
|        Batches: 1  Memory Usage: 56kB                                                                                                                                         |
|        Buffers: shared hit=44                                                                                                                                                 |
|        ->  Hash Join  (cost=78.62..282.65 rows=4734 width=11) (actual time=0.512..19.388 rows=4746.00 loops=1)                                                                |
|              Hash Cond: ((pa.placette_id)::text = (pl.plac)::text)                                                                                                            |
|              Buffers: shared hit=44                                                                                                                                           |
|              ->  Hash Join  (cost=70.77..262.18 rows=4734 width=11) (actual time=0.447..18.229 rows=4746.00 loops=1)                                                          |
|                    Hash Cond: (p.parcelle_id = pa.parcelle_id)                                                                                                                |
|                    Buffers: shared hit=42                                                                                                                                     |
|                    ->  Seq Scan on plant p  (cost=0.00..178.96 rows=4734 width=12) (actual time=0.017..16.640 rows=4746.00 loops=1)                                           |
|                          Filter: (((date)::date >= (current_setting('myvars.start_date'::text))::date) AND ((date)::date <= (current_setting('myvars.end_date'::text))::date))|
|                          Rows Removed by Filter: 286                                                                                                                          |
|                          Buffers: shared hit=28                                                                                                                               |
|                    ->  Hash  (cost=39.23..39.23 rows=2523 width=7) (actual time=0.417..0.417 rows=2523.00 loops=1)                                                            |
|                          Buckets: 4096  Batches: 1  Memory Usage: 131kB                                                                                                       |
|                          Buffers: shared hit=14                                                                                                                               |
|                          ->  Seq Scan on parcelle pa  (cost=0.00..39.23 rows=2523 width=7) (actual time=0.008..0.176 rows=2523.00 loops=1)                                    |
|                                Buffers: shared hit=14                                                                                                                         |
|              ->  Hash  (cost=4.60..4.60 rows=260 width=3) (actual time=0.058..0.059 rows=260.00 loops=1)                                                                      |
|                    Buckets: 1024  Batches: 1  Memory Usage: 17kB                                                                                                              |
|                    Buffers: shared hit=2                                                                                                                                      |
|                    ->  Seq Scan on placette pl  (cost=0.00..4.60 rows=260 width=3) (actual time=0.017..0.032 rows=260.00 loops=1)                                             |
|                          Buffers: shared hit=2                                                                                                                                |
|Planning:                                                                                                                                                                      |
|  Buffers: shared hit=40 dirtied=1                                                                                                                                             |
|Planning Time: 2.653 ms                                                                                                                                                        |
|Execution Time: 20.968 ms                                                                                                                                                      |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+




-- 1.b) Par ZONE

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|QUERY PLAN                                                                                                                                                                           |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|Sort  (cost=330.51..330.52 rows=5 width=11) (actual time=20.833..20.840 rows=5.00 loops=1)                                                                                           |
|  Sort Key: z.code                                                                                                                                                                   |
|  Sort Method: quicksort  Memory: 25kB                                                                                                                                               |
|  Buffers: shared hit=45                                                                                                                                                             |
|  ->  HashAggregate  (cost=330.40..330.45 rows=5 width=11) (actual time=20.819..20.826 rows=5.00 loops=1)                                                                            |
|        Group Key: z.code                                                                                                                                                            |
|        Batches: 1  Memory Usage: 32kB                                                                                                                                               |
|        Buffers: shared hit=45                                                                                                                                                       |
|        ->  Hash Join  (cost=79.73..306.73 rows=4734 width=11) (actual time=0.513..19.853 rows=4746.00 loops=1)                                                                      |
|              Hash Cond: ((pl.zone)::text = (z.code)::text)                                                                                                                          |
|              Buffers: shared hit=45                                                                                                                                                 |
|              ->  Hash Join  (cost=78.62..282.65 rows=4734 width=11) (actual time=0.484..18.827 rows=4746.00 loops=1)                                                                |
|                    Hash Cond: ((pa.placette_id)::text = (pl.plac)::text)                                                                                                            |
|                    Buffers: shared hit=44                                                                                                                                           |
|                    ->  Hash Join  (cost=70.77..262.18 rows=4734 width=11) (actual time=0.427..17.694 rows=4746.00 loops=1)                                                          |
|                          Hash Cond: (p.parcelle_id = pa.parcelle_id)                                                                                                                |
|                          Buffers: shared hit=42                                                                                                                                     |
|                          ->  Seq Scan on plant p  (cost=0.00..178.96 rows=4734 width=12) (actual time=0.015..16.159 rows=4746.00 loops=1)                                           |
|                                Filter: (((date)::date >= (current_setting('myvars.start_date'::text))::date) AND ((date)::date <= (current_setting('myvars.end_date'::text))::date))|
|                                Rows Removed by Filter: 286                                                                                                                          |
|                                Buffers: shared hit=28                                                                                                                               |
|                          ->  Hash  (cost=39.23..39.23 rows=2523 width=7) (actual time=0.399..0.399 rows=2523.00 loops=1)                                                            |
|                                Buckets: 4096  Batches: 1  Memory Usage: 131kB                                                                                                       |
|                                Buffers: shared hit=14                                                                                                                               |
|                                ->  Seq Scan on parcelle pa  (cost=0.00..39.23 rows=2523 width=7) (actual time=0.007..0.167 rows=2523.00 loops=1)                                    |
|                                      Buffers: shared hit=14                                                                                                                         |
|                    ->  Hash  (cost=4.60..4.60 rows=260 width=6) (actual time=0.051..0.056 rows=260.00 loops=1)                                                                      |
|                          Buckets: 1024  Batches: 1  Memory Usage: 18kB                                                                                                              |
|                          Buffers: shared hit=2                                                                                                                                      |
|                          ->  Seq Scan on placette pl  (cost=0.00..4.60 rows=260 width=6) (actual time=0.009..0.025 rows=260.00 loops=1)                                             |
|                                Buffers: shared hit=2                                                                                                                                |
|              ->  Hash  (cost=1.05..1.05 rows=5 width=3) (actual time=0.017..0.018 rows=5.00 loops=1)                                                                                |
|                    Buckets: 1024  Batches: 1  Memory Usage: 9kB                                                                                                                     |
|                    Buffers: shared hit=1                                                                                                                                            |
|                    ->  Seq Scan on zone z  (cost=0.00..1.05 rows=5 width=3) (actual time=0.012..0.013 rows=5.00 loops=1)                                                            |
|                          Buffers: shared hit=1                                                                                                                                      |
|Planning:                                                                                                                                                                            |
|  Buffers: shared hit=26                                                                                                                                                             |
|Planning Time: 0.494 ms                                                                                                                                                              |
|Execution Time: 20.936 ms                                                                                                                                                            |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+



-- 3.a) Par PLACETTE — avec index

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|QUERY PLAN                                                                                                                                                                     |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|Sort  (cost=319.35..320.00 rows=260 width=11) (actual time=23.635..23.648 rows=255.00 loops=1)                                                                                 |
|  Sort Key: pl.plac                                                                                                                                                            |
|  Sort Method: quicksort  Memory: 32kB                                                                                                                                         |
|  Buffers: shared hit=44                                                                                                                                                       |
|  ->  HashAggregate  (cost=306.32..308.92 rows=260 width=11) (actual time=23.242..23.276 rows=255.00 loops=1)                                                                  |
|        Group Key: pl.plac                                                                                                                                                     |
|        Batches: 1  Memory Usage: 56kB                                                                                                                                         |
|        Buffers: shared hit=44                                                                                                                                                 |
|        ->  Hash Join  (cost=78.62..282.65 rows=4734 width=11) (actual time=1.094..22.004 rows=4746.00 loops=1)                                                                |
|              Hash Cond: ((pa.placette_id)::text = (pl.plac)::text)                                                                                                            |
|              Buffers: shared hit=44                                                                                                                                           |
|              ->  Hash Join  (cost=70.77..262.18 rows=4734 width=11) (actual time=0.988..20.552 rows=4746.00 loops=1)                                                          |
|                    Hash Cond: (p.parcelle_id = pa.parcelle_id)                                                                                                                |
|                    Buffers: shared hit=42                                                                                                                                     |
|                    ->  Seq Scan on plant p  (cost=0.00..178.96 rows=4734 width=12) (actual time=0.021..18.140 rows=4746.00 loops=1)                                           |
|                          Filter: (((date)::date >= (current_setting('myvars.start_date'::text))::date) AND ((date)::date <= (current_setting('myvars.end_date'::text))::date))|
|                          Rows Removed by Filter: 286                                                                                                                          |
|                          Buffers: shared hit=28                                                                                                                               |
|                    ->  Hash  (cost=39.23..39.23 rows=2523 width=7) (actual time=0.944..0.945 rows=2523.00 loops=1)                                                            |
|                          Buckets: 4096  Batches: 1  Memory Usage: 131kB                                                                                                       |
|                          Buffers: shared hit=14                                                                                                                               |
|                          ->  Seq Scan on parcelle pa  (cost=0.00..39.23 rows=2523 width=7) (actual time=0.012..0.387 rows=2523.00 loops=1)                                    |
|                                Buffers: shared hit=14                                                                                                                         |
|              ->  Hash  (cost=4.60..4.60 rows=260 width=3) (actual time=0.099..0.100 rows=260.00 loops=1)                                                                      |
|                    Buckets: 1024  Batches: 1  Memory Usage: 17kB                                                                                                              |
|                    Buffers: shared hit=2                                                                                                                                      |
|                    ->  Seq Scan on placette pl  (cost=0.00..4.60 rows=260 width=3) (actual time=0.017..0.040 rows=260.00 loops=1)                                             |
|                          Buffers: shared hit=2                                                                                                                                |
|Planning:                                                                                                                                                                      |
|  Buffers: shared hit=50 read=7                                                                                                                                                |
|Planning Time: 0.960 ms                                                                                                                                                        |
|Execution Time: 23.756 ms                                                                                                                                                      |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+



-- 3.b) Par ZONE — avec index

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|QUERY PLAN                                                                                                                                                                           |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|Sort  (cost=330.51..330.52 rows=5 width=11) (actual time=18.547..18.554 rows=5.00 loops=1)                                                                                           |
|  Sort Key: z.code                                                                                                                                                                   |
|  Sort Method: quicksort  Memory: 25kB                                                                                                                                               |
|  Buffers: shared hit=45                                                                                                                                                             |
|  ->  HashAggregate  (cost=330.40..330.45 rows=5 width=11) (actual time=18.535..18.542 rows=5.00 loops=1)                                                                            |
|        Group Key: z.code                                                                                                                                                            |
|        Batches: 1  Memory Usage: 32kB                                                                                                                                               |
|        Buffers: shared hit=45                                                                                                                                                       |
|        ->  Hash Join  (cost=79.73..306.73 rows=4734 width=11) (actual time=0.515..17.711 rows=4746.00 loops=1)                                                                      |
|              Hash Cond: ((pl.zone)::text = (z.code)::text)                                                                                                                          |
|              Buffers: shared hit=45                                                                                                                                                 |
|              ->  Hash Join  (cost=78.62..282.65 rows=4734 width=11) (actual time=0.488..16.831 rows=4746.00 loops=1)                                                                |
|                    Hash Cond: ((pa.placette_id)::text = (pl.plac)::text)                                                                                                            |
|                    Buffers: shared hit=44                                                                                                                                           |
|                    ->  Hash Join  (cost=70.77..262.18 rows=4734 width=11) (actual time=0.433..15.873 rows=4746.00 loops=1)                                                          |
|                          Hash Cond: (p.parcelle_id = pa.parcelle_id)                                                                                                                |
|                          Buffers: shared hit=42                                                                                                                                     |
|                          ->  Seq Scan on plant p  (cost=0.00..178.96 rows=4734 width=12) (actual time=0.013..14.476 rows=4746.00 loops=1)                                           |
|                                Filter: (((date)::date >= (current_setting('myvars.start_date'::text))::date) AND ((date)::date <= (current_setting('myvars.end_date'::text))::date))|
|                                Rows Removed by Filter: 286                                                                                                                          |
|                                Buffers: shared hit=28                                                                                                                               |
|                          ->  Hash  (cost=39.23..39.23 rows=2523 width=7) (actual time=0.407..0.407 rows=2523.00 loops=1)                                                            |
|                                Buckets: 4096  Batches: 1  Memory Usage: 131kB                                                                                                       |
|                                Buffers: shared hit=14                                                                                                                               |
|                                ->  Seq Scan on parcelle pa  (cost=0.00..39.23 rows=2523 width=7) (actual time=0.006..0.169 rows=2523.00 loops=1)                                    |
|                                      Buffers: shared hit=14                                                                                                                         |
|                    ->  Hash  (cost=4.60..4.60 rows=260 width=6) (actual time=0.050..0.055 rows=260.00 loops=1)                                                                      |
|                          Buckets: 1024  Batches: 1  Memory Usage: 18kB                                                                                                              |
|                          Buffers: shared hit=2                                                                                                                                      |
|                          ->  Seq Scan on placette pl  (cost=0.00..4.60 rows=260 width=6) (actual time=0.008..0.024 rows=260.00 loops=1)                                             |
|                                Buffers: shared hit=2                                                                                                                                |
|              ->  Hash  (cost=1.05..1.05 rows=5 width=3) (actual time=0.016..0.016 rows=5.00 loops=1)                                                                                |
|                    Buckets: 1024  Batches: 1  Memory Usage: 9kB                                                                                                                     |
|                    Buffers: shared hit=1                                                                                                                                            |
|                    ->  Seq Scan on zone z  (cost=0.00..1.05 rows=5 width=3) (actual time=0.011..0.012 rows=5.00 loops=1)                                                            |
|                          Buffers: shared hit=1                                                                                                                                      |
|Planning:                                                                                                                                                                            |
|  Buffers: shared hit=32                                                                                                                                                             |
|Planning Time: 0.515 ms                                                                                                                                                              |
|Execution Time: 18.631 ms                                                                                                                                                            |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

